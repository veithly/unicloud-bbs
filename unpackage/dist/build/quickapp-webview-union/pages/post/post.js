(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/post/post"],{"0710":function(e,t,n){"use strict";(function(e,t){n("d48a");o(n("66fd"));var r=o(n("4f2b"));function o(e){return e&&e.__esModule?e:{default:e}}e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n("8adf")["default"],n("8adf")["createPage"])},"12b7":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("a34a"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n,r,o,a,c){try{var u=e[a](c),s=u.value}catch(i){return void n(i)}u.done?t(s):Promise.resolve(s).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var c=e.apply(t,n);function u(e){a(c,r,o,u,s,"next",e)}function s(e){a(c,r,o,u,s,"throw",e)}u(void 0)}))}}var u={props:{f_id:{type:String,default:""}},data:function(){return{loading:!1}},methods:{resolveFollow:function(e){var t=this;return c(r.default.mark((function e(){var n,o,a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.loading||(t.loading=!0,n=function(e){return t.$U.notice(e)},o=function(){t.f_id?t.$U.notice("取关成功"):t.$U.notice("关注成功")},a=function(){t.$U.hideLoading(),t.loading=!1},t.$emit("follow",{id:t.f_id,fail:n,success:o,complete:a}));case 1:case"end":return e.stop()}}),e)})))()}}};t.default=u},1597:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var r={cButton:function(){return n.e("components/c-button/c-button").then(n.bind(null,"8fac"))}},o=function(){var e=this,t=e.$createElement;e._self._c},a=[]},2871:function(e,t,n){"use strict";n.r(t);var r=n("1597"),o=n("64c2");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);var c,u=n("f0c5"),s=Object(u["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],c);t["default"]=s.exports},"4c0f":function(e,t,n){"use strict";var r=n("6bc6"),o=n.n(r);o.a},"4f2b":function(e,t,n){"use strict";n.r(t);var r=n("e449"),o=n("bb60");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("4c0f");var c,u=n("f0c5"),s=Object(u["a"])(o["default"],r["b"],r["c"],!1,null,"86843b84",null,!1,r["a"],c);t["default"]=s.exports},"64c2":function(e,t,n){"use strict";n.r(t);var r=n("12b7"),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},"6bc6":function(e,t,n){},bb60:function(e,t,n){"use strict";n.r(t);var r=n("d9c5"),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},d9c5:function(e,t,n){"use strict";(function(e,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=u(n("a34a")),a=u(n("2871")),c=u(n("770b"));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,o,a,c){try{var u=e[a](c),s=u.value}catch(i){return void n(i)}u.done?t(s):Promise.resolve(s).then(r,o)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){d(a,r,o,c,u,"next",e)}function u(e){d(a,r,o,c,u,"throw",e)}c(void 0)}))}}var m=function(){n.e("pages/post/header").then(function(){return resolve(n("6209"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("pages/post/collect").then(function(){return resolve(n("51b9"))}.bind(null,n)).catch(n.oe)},h=function(){n.e("pages/post/post-comment-release").then(function(){return resolve(n("a45b"))}.bind(null,n)).catch(n.oe)},v={mixins:[c.default],components:{cHeader:m,cCollect:p,cFollow:a.default,cPostCommentRelease:h},destroyed:function(){e.$emit("clearImgCache")},onLoad:function(){var t=this;e.$emit("getPost",(function(e){return t.post=e})),this.refreshHistory(),this.countTotalComment()},onPullDownRefresh:function(){var t=this;return f(o.default.mark((function n(){var r,a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.$refs.comments&&(r=new Promise((function(e){t.$refs.comments.loadData({clear:!0},e)}))),a=new Promise((function(e){setTimeout(e,3e3)})),n.next=4,Promise.race([a,r]);case 4:t.countTotalComment(),e.stopPullDownRefresh();case 6:case"end":return n.stop()}}),n)})))()},onReachBottom:function(){this.$refs.comments&&this.$refs.comments.loadMore()},data:function(){var e=r.getCurrentUserInfo(),t=e.uid,n="arrayElemAt(user_id.username, 0) as username,arrayElemAt(user_id.avatar, 0) as avatarUrl,arrayElemAt(user_id._id, 0) as comment_user_id,comment_content,comment_date,size(praise_user_ids._id) as praiseNum,in('".concat(t,"', praise_user_ids._id) as praiseStatus");return{uid:t,post:{},commentsFiled:n,commentPosition:0,totalCommentCount:0,followLoading:!1,imgLoadedSuccessStatus:!1}},methods:{refreshHistory:function(){this.$A.history.update({uid:this.uid,pid:this.post._id})},toCommentPosition:function(){e.pageScrollTo({scrollTop:this.commentPosition})},countTotalComment:function(){var e=this;return f(o.default.mark((function t(){var n;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$A.comment.countTotalComment({_id:e.post._id});case 2:n=t.sent,e.totalCommentCount=n;case 4:case"end":return t.stop()}}),t)})))()},countComment:function(e){var t=this;return f(o.default.mark((function n(){var r,a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.v,n.next=3,t.$A.comment.countCommentComment({_id:r._id});case 3:a=n.sent,e.commentCount=a;case 5:case"end":return n.stop()}}),n)})))()},resolveCommentAction:function(t){t.postID=this.post._id,e.setStorageSync("mainComment",t),e.navigateTo({url:"/pages/comment/comment"})},resolveCommentPraise:function(e){var t=this;return f(o.default.mark((function n(){var r,a,c,u,s;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.fail,a=e.success,c=e.complete,u=e.payload,s=t.uid,n.prev=2,n.next=5,t.$A.comment.praise(i({uid:s},u));case 5:a(),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](2),r(n.t0.message);case 11:return n.prev=11,c(),n.finish(11);case 14:case"end":return n.stop()}}),n,null,[[2,8,11,14]])})))()},activeColor:function(e){return e&&"main-color"},postPraise:function(t){var n=this;return f(o.default.mark((function r(){var a,c,u;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t.useLoading(),c=n.post.praiseStatus,r.prev=2,u=n.$A.post.praise({uid:n.uid,postID:n.post._id,praiseStatus:n.post.praiseStatus}),r.next=6,n.$U.delayRequest(u);case 6:c?n.post.praiseNum--:n.post.praiseNum++,n.post.praiseStatus=!n.post.praiseStatus,e.setStorageSync("post",n.post),r.next=14;break;case 11:r.prev=11,r.t0=r["catch"](2),n.$U.notice(r.t0.message);case 14:return r.prev=14,a(),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[2,11,14,17]])})))()},postCommentRelease:function(e){var t=this;return f(o.default.mark((function n(){var r,a,c,u;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.payload,a=e.fail,c=e.success,u=e.complete,n.prev=1,n.next=4,t.$A.comment.createPost(i(i({},r),{},{post_id:t.post._id}));case 4:c(),n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](1),a(n.t0.message);case 10:return n.prev=10,u(),n.finish(10);case 13:case"end":return n.stop()}}),n,null,[[1,7,10,13]])})))()},onMphtmlLoad:function(){var t=100,n=this.$refs.mphtml.imgCache,r=n.list.length>t;r&&e.once("clearImgCache",(function(){n.clear()}))},onMphtmlReady:function(){var e=this;this.imgLoadedSuccessStatus=!0,this.$refs.mphtml.getRect().then((function(t){e.commentPosition=t.height}))},openPopup:function(){this.$refs.popup.open()},resolveCollect:function(e){var t=this;return f(o.default.mark((function n(){var r,a,c,u,s,i,l;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.id,a=e.fail,c=e.success,u=e.complete,s=t.$A.stock,i=s.create,l=s.destory,n.prev=2,!r){n.next=8;break}return n.next=6,l({id:r});case 6:n.next=10;break;case 8:return n.next=10,i({post_id:t.post._id});case 10:c(),n.next=16;break;case 13:n.prev=13,n.t0=n["catch"](2),a(n.t0.message);case 16:return n.prev=16,t.$refs.stock.loadData({clear:!0},u),n.finish(16);case 19:case"end":return n.stop()}}),n,null,[[2,13,16,19]])})))()},resolveFollow:function(e){var t=this;return f(o.default.mark((function n(){var r,a,c,u,s,i,l;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.id,a=e.fail,c=e.success,u=e.complete,s=t.$A.follow,i=s.create,l=s.destory,n.prev=2,!r){n.next=8;break}return n.next=6,l({id:r});case 6:n.next=10;break;case 8:return n.next=10,i({follow_user_id:t.post.authorID});case 10:c(),n.next=16;break;case 13:n.prev=13,n.t0=n["catch"](2),a(n.t0.message);case 16:return n.prev=16,t.$refs.follows.loadData({clear:!0},u),n.finish(16);case 19:case"end":return n.stop()}}),n,null,[[2,13,16,19]])})))()}}};t.default=v}).call(this,n("8adf")["default"],n("a9ff")["default"])},e449:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var r={cSticky:function(){return n.e("components/c-sticky/c-sticky").then(n.bind(null,"4a0a"))},cStatusBar:function(){return n.e("components/c-status-bar/c-status-bar").then(n.bind(null,"0aad"))},unicloudDb:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-cli-shared/components/unicloud-db")]).then(n.bind(null,"960d"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"eb79"))},cImage:function(){return n.e("components/c-image/c-image").then(n.bind(null,"03db"))},uniDateformat:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat")]).then(n.bind(null,"050d"))},cErrorTip:function(){return Promise.all([n.e("common/vendor"),n.e("components/c-error-tip/c-error-tip")]).then(n.bind(null,"fb9e"))},cScrollLoadMore:function(){return n.e("components/c-scroll-load-more/c-scroll-load-more").then(n.bind(null,"4b83"))},mpHtml:function(){return Promise.all([n.e("common/vendor"),n.e("components/mp-html/mp-html")]).then(n.bind(null,"96d0"))},cBackTop:function(){return n.e("components/c-back-top/c-back-top").then(n.bind(null,"048f"))},cDesc:function(){return n.e("components/c-desc/c-desc").then(n.bind(null,"b9b7"))},cComment:function(){return n.e("components/c-comment/c-comment").then(n.bind(null,"fa9c"))},cTemp:function(){return n.e("components/c-temp/c-temp").then(n.bind(null,"74f7"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.$hasScopedSlotsParams("0d42ce86-11")),r=n?e.$getScopedSlotsParams("0d42ce86-11","default","error"):null,o=n&&r?e.$getScopedSlotsParams("0d42ce86-11","default","error"):null,a=n&&!r?e.$getScopedSlotsParams("0d42ce86-11","default","loading"):null,c=n&&!r&&a?e.$getScopedSlotsParams("0d42ce86-11","default","loading"):null,u=n&&!r&&a?e.$getScopedSlotsParams("0d42ce86-11","default","hasMore"):null,s=!n||r||a?null:e.$getScopedSlotsParams("0d42ce86-11","default","data")&&e.$getScopedSlotsParams("0d42ce86-11","default","data").content,i=e.$hasScopedSlotsParams("0d42ce86-16"),l=i?e.$getScopedSlotsParams("0d42ce86-16","default","error"):null,d=i&&l?e.$getScopedSlotsParams("0d42ce86-16","default","error"):null,f=i&&!l?e.$getScopedSlotsParams("0d42ce86-16","default","data"):null,m=i&&!l?e.$getScopedSlotsParams("0d42ce86-16","default","hasMore"):null,p=i&&!l?e.$getScopedSlotsParams("0d42ce86-16","default","loading"):null,h=e.activeColor(e.post.praiseStatus);e.$mp.data=Object.assign({},{$root:{m0:n,m1:r,m2:o,m3:a,m4:c,m5:u,m6:s,m7:i,m8:l,m9:d,l0:f,m10:m,m11:p,m12:h}})},a=[]}},[["0710","common/runtime","common/vendor"]]]);